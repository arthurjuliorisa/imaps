generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model item_types {
  item_type_code String   @id @db.VarChar(10)
  name_en        String   @db.VarChar(100)
  name_de        String?  @db.VarChar(100)
  name_id        String?  @db.VarChar(100)
  category       String   @db.VarChar(50)
  description    String?
  is_active      Boolean  @default(true)
  sort_order     Int?
  created_at     DateTime @default(now()) @db.Timestamptz(6)
  updated_at     DateTime @updatedAt @db.Timestamptz(6)
}

model companies {
  id                    Int                     @id @default(autoincrement())
  code                  Int                     @unique
  name                  String                  @db.VarChar(200)
  status                CompanyStatus           @default(ACTIVE)
  created_at            DateTime                @default(now()) @db.Timestamptz(6)
  updated_at            DateTime                @updatedAt @db.Timestamptz(6)
  deleted_at            DateTime?               @db.Timestamptz(6)
  beginning_balances    beginning_balances[]
  items                 items[]
  scrap_items           scrap_items[]
  scrap_transactions    scrap_transactions[]
  snapshot_recalc_queue snapshot_recalc_queue[]
  stock_opnames         stock_opnames[]
  users                 users[]

  @@index([code])
  @@index([status])
}

model items {
  id           Int       @id @default(autoincrement())
  company_code Int
  item_code    String    @db.VarChar(50)
  item_name    String    @db.VarChar(200)
  item_type    String    @db.VarChar(10)
  hs_code      String?   @db.VarChar(20)
  uom          String    @db.VarChar(20)
  currency     Currency  @default(USD)
  is_active    Boolean   @default(true)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at   DateTime? @db.Timestamptz(6)
  company      companies @relation(fields: [company_code], references: [code])

  @@unique([company_code, item_code])
  @@index([company_code])
  @@index([item_code])
  @@index([item_type])
  @@index([is_active])
}

model users {
  id                String              @id @default(dbgenerated("gen_random_uuid()"))
  username          String              @unique @db.VarChar(100)
  email             String              @unique @db.VarChar(200)
  password          String              @db.VarChar(255)
  full_name         String              @db.VarChar(200)
  role              String              @default("USER") @db.VarChar(50)
  company_code      Int?
  is_active         Boolean             @default(true)
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  updated_at        DateTime            @updatedAt @db.Timestamptz(6)
  deleted_at        DateTime?           @db.Timestamptz(6)
  activity_logs     activity_logs[]
  user_access_menus user_access_menus[]
  company           companies?          @relation(fields: [company_code], references: [code], onDelete: NoAction, onUpdate: NoAction)

  @@index([username])
  @@index([email])
  @@index([company_code])
}

model menus {
  id                String              @id @default(dbgenerated("gen_random_uuid()"))
  parent_id         String?
  menu_name         String              @db.VarChar(100)
  menu_path         String?             @db.VarChar(255)
  menu_icon         String?             @db.VarChar(50)
  menu_order        Int?
  is_active         Boolean             @default(true)
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  updated_at        DateTime            @updatedAt @db.Timestamptz(6)
  parent            menus?              @relation("MenuHierarchy", fields: [parent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children          menus[]             @relation("MenuHierarchy")
  user_access_menus user_access_menus[]

  @@index([parent_id])
  @@index([menu_order])
}

model user_access_menus {
  id         String   @id @default(dbgenerated("gen_random_uuid()"))
  user_id    String
  menu_id    String
  can_view   Boolean  @default(true)
  can_create Boolean  @default(false)
  can_edit   Boolean  @default(false)
  can_delete Boolean  @default(false)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @updatedAt @db.Timestamptz(6)
  menu       menus    @relation(fields: [menu_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, menu_id])
  @@index([user_id])
  @@index([menu_id])
}

model beginning_balances {
  id           Int                        @id @default(autoincrement())
  company_code Int
  item_code    String                     @db.VarChar(50)
  item_name    String                     @db.VarChar(200)
  item_type    String                     @db.VarChar(10)
  uom          String                     @db.VarChar(20)
  qty          Decimal                    @db.Decimal(15, 3)
  balance_date DateTime                   @db.Date
  created_at   DateTime                   @default(now()) @db.Timestamptz(6)
  updated_at   DateTime                   @updatedAt @db.Timestamptz(6)
  deleted_at   DateTime?                  @db.Timestamptz(6)
  remarks      String?                    @db.VarChar(1000)
  ppkeks       beginning_balance_ppkeks[]
  company      companies                  @relation(fields: [company_code], references: [code])

  @@unique([company_code, item_code, balance_date])
  @@index([company_code])
  @@index([item_code])
  @@index([balance_date])
}

model beginning_balance_ppkeks {
  id                   Int                @id @default(autoincrement())
  beginning_balance_id Int
  ppkek_number         String             @db.VarChar(50)
  created_at           DateTime           @default(now()) @db.Timestamptz(6)
  beginning_balance    beginning_balances @relation(fields: [beginning_balance_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_beginning_balance")

  @@unique([beginning_balance_id, ppkek_number], map: "uk_beginning_balance_ppkek")
  @@index([beginning_balance_id], map: "idx_beginning_balance_ppkeks_balance_id")
  @@index([ppkek_number], map: "idx_beginning_balance_ppkeks_ppkek_number")
}

model scrap_items {
  id                 Int                  @id @default(autoincrement())
  company_code       Int
  scrap_code         String               @unique @db.VarChar(50)
  scrap_name         String               @db.VarChar(200)
  scrap_description  String?              @db.VarChar(500)
  uom                String               @db.VarChar(20)
  is_active          Boolean              @default(true)
  created_at         DateTime             @default(now()) @db.Timestamptz(6)
  updated_at         DateTime             @updatedAt @db.Timestamptz(6)
  deleted_at         DateTime?            @db.Timestamptz(6)
  scrap_item_details scrap_item_details[]
  company            companies            @relation(fields: [company_code], references: [code])

  @@unique([company_code, scrap_code])
  @@index([company_code])
  @@index([scrap_code])
  @@index([is_active])
}

model scrap_item_details {
  id             Int         @id @default(autoincrement())
  scrap_item_id  Int
  component_code String      @db.VarChar(50)
  component_name String      @db.VarChar(200)
  component_type String      @db.VarChar(10)
  uom            String      @db.VarChar(20)
  quantity       Decimal     @db.Decimal(15, 3)
  percentage     Decimal?    @db.Decimal(5, 2)
  remarks        String?     @db.VarChar(500)
  created_at     DateTime    @default(now()) @db.Timestamptz(6)
  updated_at     DateTime    @updatedAt @db.Timestamptz(6)
  scrap_item     scrap_items @relation(fields: [scrap_item_id], references: [id], onDelete: Cascade)

  @@unique([scrap_item_id, component_code])
  @@index([scrap_item_id])
  @@index([component_code])
}

model audit_logs {
  id         BigInt   @id @default(autoincrement())
  table_name String   @db.VarChar(100)
  record_id  Int
  action     String   @db.VarChar(20)
  old_values Json?
  new_values Json?
  changed_by String?  @db.VarChar(100)
  changed_at DateTime @default(now()) @db.Timestamptz(6)
  ip_address String?  @db.VarChar(50)
  user_agent String?  @db.VarChar(500)

  @@index([table_name])
  @@index([record_id])
  @@index([action])
  @@index([changed_at])
}

model activity_logs {
  id          BigInt   @id @default(autoincrement())
  user_id     String?  @db.VarChar(100)
  action      String   @db.VarChar(100)
  description String
  status      String   @default("success") @db.VarChar(20)
  metadata    Json?
  ip_address  String?  @db.VarChar(50)
  user_agent  String?  @db.VarChar(500)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  users       users?   @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "fk_activity_logs_user")

  @@index([action], map: "idx_activity_logs_action")
  @@index([created_at], map: "idx_activity_logs_created_at")
  @@index([status], map: "idx_activity_logs_status")
  @@index([user_id], map: "idx_activity_logs_user_id")
}

model incoming_goods {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  incoming_evidence_number  String              @db.VarChar(50)
  incoming_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  shipper_name              String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @updatedAt @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, wms_id, incoming_date])
  @@unique([company_code, id, incoming_date])
  @@index([wms_id])
  @@index([company_code])
  @@index([incoming_date])
  @@index([ppkek_number])
  @@index([customs_document_type])
  @@index([incoming_evidence_number])
  @@index([company_code, incoming_date, deleted_at], map: "idx_incoming_goods_date_range")
}

model incoming_good_items {
  id                    Int       @id @default(autoincrement())
  incoming_good_id      Int
  incoming_good_company Int
  incoming_good_date    DateTime  @db.Date
  item_type             String    @db.VarChar(10)
  item_code             String    @db.VarChar(50)
  item_name             String    @db.VarChar(200)
  hs_code               String?   @db.VarChar(20)
  uom                   String    @db.VarChar(20)
  qty                   Decimal   @db.Decimal(15, 3)
  currency              Currency
  amount                Decimal   @db.Decimal(18, 4)
  created_at            DateTime  @default(now()) @db.Timestamptz(6)
  updated_at            DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at            DateTime? @db.Timestamptz(6)

  @@index([incoming_good_id])
  @@index([incoming_good_id, incoming_good_company, incoming_good_date])
  @@index([item_code])
  @@index([item_type])
  @@index([item_type, deleted_at], map: "idx_incoming_good_items_type")
}

model material_usages {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  work_order_number        String?   @db.VarChar(50)
  cost_center_number       String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, transaction_date])
  @@unique([company_code, id, transaction_date])
  @@index([wms_id])
  @@index([company_code])
  @@index([transaction_date])
  @@index([work_order_number])
  @@index([cost_center_number])
  @@index([internal_evidence_number])
  @@index([company_code, transaction_date, deleted_at], map: "idx_material_usages_date_range")
}

model material_usage_items {
  id                     Int       @id @default(autoincrement())
  material_usage_id      Int
  material_usage_company Int
  material_usage_date    DateTime  @db.Date
  item_type              String    @db.VarChar(10)
  item_code              String    @db.VarChar(50)
  item_name              String    @db.VarChar(200)
  uom                    String    @db.VarChar(20)
  qty                    Decimal   @db.Decimal(15, 3)
  ppkek_number           String?   @db.VarChar(50)
  created_at             DateTime  @default(now()) @db.Timestamptz(6)
  updated_at             DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at             DateTime? @db.Timestamptz(6)

  @@index([material_usage_id])
  @@index([material_usage_id, material_usage_company, material_usage_date])
  @@index([item_code])
  @@index([item_type])
  @@index([ppkek_number])
  @@index([item_type, deleted_at], map: "idx_material_usage_items_type")
}

model wip_balances {
  id           Int       @default(autoincrement())
  wms_id       String    @db.VarChar(100)
  company_code Int
  item_type    String    @db.VarChar(10)
  item_code    String    @db.VarChar(50)
  item_name    String    @db.VarChar(200)
  stock_date   DateTime  @db.Date
  uom          String    @db.VarChar(20)
  qty          Decimal   @db.Decimal(15, 3)
  timestamp    DateTime  @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at   DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, stock_date])
  @@index([wms_id])
  @@index([company_code])
  @@index([stock_date])
  @@index([item_code])
  @@index([item_type])
}

model production_outputs {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, transaction_date])
  @@unique([company_code, id, transaction_date])
  @@index([wms_id])
  @@index([company_code])
  @@index([transaction_date])
  @@index([internal_evidence_number])
  @@index([company_code, transaction_date, deleted_at], map: "idx_production_outputs_date_range")
}

model production_output_items {
  id                        Int       @id @default(autoincrement())
  production_output_id      Int
  production_output_company Int
  production_output_date    DateTime  @db.Date
  item_type                 String    @db.VarChar(10)
  item_code                 String    @db.VarChar(50)
  item_name                 String    @db.VarChar(200)
  uom                       String    @db.VarChar(20)
  qty                       Decimal   @db.Decimal(15, 3)
  work_order_numbers        String[]
  created_at                DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at                DateTime? @db.Timestamptz(6)

  @@index([production_output_id])
  @@index([production_output_id, production_output_company, production_output_date])
  @@index([item_code])
  @@index([item_type])
  @@index([item_type, deleted_at], map: "idx_production_output_items_type")
}

model outgoing_goods {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  outgoing_evidence_number  String              @db.VarChar(50)
  outgoing_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  recipient_name            String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @updatedAt @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, wms_id, outgoing_date])
  @@unique([company_code, id, outgoing_date])
  @@index([wms_id])
  @@index([company_code])
  @@index([outgoing_date])
  @@index([ppkek_number])
  @@index([customs_document_type])
  @@index([outgoing_evidence_number])
  @@index([company_code, outgoing_date, deleted_at], map: "idx_outgoing_goods_date_range")
}

model outgoing_good_items {
  id                                  Int                                   @id @default(autoincrement())
  outgoing_good_id                    Int
  outgoing_good_company               Int
  outgoing_good_date                  DateTime                              @db.Date
  item_type                           String                                @db.VarChar(10)
  item_code                           String                                @db.VarChar(50)
  item_name                           String                                @db.VarChar(200)
  production_output_wms_ids           String[]
  hs_code                             String?                               @db.VarChar(20)
  uom                                 String                                @db.VarChar(20)
  qty                                 Decimal                               @db.Decimal(15, 3)
  currency                            Currency
  amount                              Decimal                               @db.Decimal(18, 4)
  created_at                          DateTime                              @default(now()) @db.Timestamptz(6)
  updated_at                          DateTime                              @updatedAt @db.Timestamptz(6)
  deleted_at                          DateTime?                             @db.Timestamptz(6)
  incoming_ppkek_numbers              String[]                              @default([])
  outgoing_fg_production_traceability outgoing_fg_production_traceability[]

  @@index([outgoing_good_id])
  @@index([outgoing_good_id, outgoing_good_company, outgoing_good_date])
  @@index([item_code])
  @@index([item_type])
  @@index([item_type, deleted_at], map: "idx_outgoing_good_items_type")
}

model adjustments {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  wms_doc_type             String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, transaction_date])
  @@unique([company_code, id, transaction_date])
  @@index([wms_id])
  @@index([company_code])
  @@index([transaction_date])
  @@index([internal_evidence_number])
}

model adjustment_items {
  id                 Int            @id @default(autoincrement())
  adjustment_id      Int
  adjustment_company Int
  adjustment_date    DateTime       @db.Date
  adjustment_type    AdjustmentType
  item_type          String         @db.VarChar(10)
  item_code          String         @db.VarChar(50)
  item_name          String         @db.VarChar(200)
  uom                String         @db.VarChar(20)
  qty                Decimal        @db.Decimal(15, 3)
  reason             String?        @db.VarChar(500)
  created_at         DateTime       @default(now()) @db.Timestamptz(6)
  updated_at         DateTime       @updatedAt @db.Timestamptz(6)
  deleted_at         DateTime?      @db.Timestamptz(6)

  @@index([adjustment_id])
  @@index([adjustment_id, adjustment_company, adjustment_date])
  @@index([item_code])
  @@index([item_type])
  @@index([adjustment_type])
  @@index([item_type, adjustment_type, deleted_at], map: "idx_adjustment_items_type")
}

model scrap_transactions {
  id                        Int                       @id @default(autoincrement())
  company_code              Int
  transaction_date          DateTime                  @db.Date
  transaction_type          String                    @db.VarChar(10)
  document_number           String                    @db.VarChar(100)
  source                    String?                   @db.VarChar(200)
  recipient_name            String?                   @db.VarChar(200)
  disposal_method           String?                   @db.VarChar(100)
  remarks                   String?                   @db.VarChar(1000)
  timestamp                 DateTime                  @default(now()) @db.Timestamptz(6)
  created_at                DateTime                  @default(now()) @db.Timestamptz(6)
  updated_at                DateTime                  @updatedAt @db.Timestamptz(6)
  deleted_at                DateTime?                 @db.Timestamptz(6)
  ppkek_number              String?                   @db.VarChar(50)
  customs_registration_date DateTime?                 @db.Date
  customs_document_type     String?                   @db.VarChar(10)
  items                     scrap_transaction_items[]
  company                   companies                 @relation(fields: [company_code], references: [code])

  @@unique([company_code, id, transaction_date])
  @@index([company_code])
  @@index([transaction_date])
  @@index([document_number])
  @@index([transaction_type])
}

model scrap_transaction_items {
  id                        Int                @id @default(autoincrement())
  scrap_transaction_id      Int
  scrap_transaction_company Int
  scrap_transaction_date    DateTime           @db.Date
  item_type                 String             @default("SCRAP") @db.VarChar(10)
  item_code                 String             @db.VarChar(50)
  item_name                 String             @db.VarChar(200)
  uom                       String             @db.VarChar(20)
  qty                       Decimal            @db.Decimal(15, 3)
  currency                  Currency
  amount                    Decimal            @db.Decimal(18, 4)
  scrap_reason              String?            @db.VarChar(500)
  remarks                   String?            @db.VarChar(500)
  created_at                DateTime           @default(now()) @db.Timestamptz(6)
  updated_at                DateTime           @updatedAt @db.Timestamptz(6)
  deleted_at                DateTime?          @db.Timestamptz(6)
  scrap_transaction         scrap_transactions @relation(fields: [scrap_transaction_company, scrap_transaction_id, scrap_transaction_date], references: [company_code, id, transaction_date], onDelete: Cascade)

  @@index([scrap_transaction_id])
  @@index([scrap_transaction_id, scrap_transaction_company, scrap_transaction_date])
  @@index([item_code])
  @@index([item_type])
}

model work_order_material_consumption {
  id                     BigInt   @default(autoincrement())
  material_usage_id      Int
  material_usage_item_id Int
  material_usage_wms_id  String   @db.VarChar(100)
  work_order_number      String   @db.VarChar(50)
  company_code           Int
  item_code              String   @db.VarChar(50)
  ppkek_number           String?  @db.VarChar(50)
  qty_consumed           Decimal  @db.Decimal(15, 3)
  trx_date               DateTime @db.Date
  created_at             DateTime @default(now()) @db.Timestamptz(6)

  @@id([id, trx_date])
  @@unique([material_usage_wms_id, work_order_number, item_code, trx_date])
  @@index([work_order_number])
  @@index([company_code])
  @@index([ppkek_number])
  @@index([trx_date])
}

model work_order_fg_production {
  id                        BigInt   @default(autoincrement())
  production_output_id      Int
  production_output_item_id Int
  production_wms_id         String   @db.VarChar(100)
  work_order_number         String   @db.VarChar(50)
  company_code              Int
  item_type                 String   @db.VarChar(10)
  item_code                 String   @db.VarChar(50)
  qty_produced              Decimal  @db.Decimal(15, 3)
  trx_date                  DateTime @db.Date
  created_at                DateTime @default(now()) @db.Timestamptz(6)

  @@id([id, trx_date])
  @@unique([production_wms_id, work_order_number, item_code, trx_date], name: "work_order_fg_production_unique")
  @@index([work_order_number])
  @@index([company_code])
  @@index([item_type])
  @@index([trx_date])
}

model outgoing_fg_production_traceability {
  id                    BigInt              @default(autoincrement())
  outgoing_good_item_id Int
  outgoing_wms_id       String              @db.VarChar(100)
  production_wms_id     String              @db.VarChar(100)
  company_code          Int
  item_code             String              @db.VarChar(50)
  trx_date              DateTime            @db.Date
  allocated_qty         Decimal?            @db.Decimal(15, 3)
  allocation_notes      String?
  created_at            DateTime            @default(now()) @db.Timestamptz(6)
  updated_at            DateTime            @updatedAt @db.Timestamptz(6)
  outgoing_good_item    outgoing_good_items @relation(fields: [outgoing_good_item_id], references: [id], onDelete: Cascade)

  @@id([id, trx_date])
  @@unique([outgoing_wms_id, production_wms_id, item_code, trx_date])
  @@index([outgoing_wms_id])
  @@index([production_wms_id])
  @@index([company_code])
  @@index([trx_date])
}

model stock_daily_snapshot {
  id                 BigInt   @default(autoincrement())
  company_code       Int
  item_type          String   @db.VarChar(10)
  item_code          String   @db.VarChar(50)
  item_name          String   @db.VarChar(200)
  uom                String   @db.VarChar(20)
  opening_balance    Decimal  @default(0) @db.Decimal(15, 3)
  closing_balance    Decimal  @default(0) @db.Decimal(15, 3)
  incoming_qty       Decimal  @default(0) @db.Decimal(15, 3)
  outgoing_qty       Decimal  @default(0) @db.Decimal(15, 3)
  production_qty     Decimal  @default(0) @db.Decimal(15, 3)
  material_usage_qty Decimal  @default(0) @db.Decimal(15, 3)
  adjustment_qty     Decimal  @default(0) @db.Decimal(15, 3)
  wip_balance_qty    Decimal? @db.Decimal(15, 3)
  snapshot_date      DateTime @db.Date
  calculated_at      DateTime @default(now()) @db.Timestamptz(6)
  calculation_method String   @db.VarChar(50)
  created_at         DateTime @default(now()) @db.Timestamptz(6)
  updated_at         DateTime @updatedAt @db.Timestamptz(6)

  @@id([id, snapshot_date])
  @@unique([company_code, item_type, item_code, snapshot_date], map: "stock_snapshot_company_item_date_key")
  @@index([company_code, item_type, snapshot_date], map: "idx_stock_snapshot_item_type_date")
  @@index([company_code, snapshot_date], map: "stock_snapshot_company_date_idx")
  @@index([snapshot_date], map: "stock_snapshot_date_idx")
  @@index([item_type, snapshot_date], map: "stock_snapshot_item_date_idx")
}

model snapshot_recalc_queue {
  id            BigInt       @id @default(autoincrement())
  company_code  Int
  item_type     String?      @db.VarChar(10)
  item_code     String?      @db.VarChar(50)
  recalc_date   DateTime     @db.Date
  status        RecalcStatus @default(PENDING)
  priority      Int          @default(0)
  reason        String?      @db.VarChar(500)
  queued_at     DateTime     @default(now()) @db.Timestamptz(6)
  started_at    DateTime?    @db.Timestamptz(6)
  completed_at  DateTime?    @db.Timestamptz(6)
  error_message String?
  company       companies    @relation(fields: [company_code], references: [code], onDelete: Cascade)

  @@unique([company_code, recalc_date, item_type, item_code])
  @@index([status, priority, queued_at])
  @@index([company_code, recalc_date])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model adjustments_1310 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  wms_doc_type             String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "adjustments_1310_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "adjustments_1310_company_code_wms_id_transaction_date_idx")
  @@index([company_code])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model adjustments_1370 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  wms_doc_type             String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "adjustments_1370_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "adjustments_1370_company_code_wms_id_transaction_date_idx")
  @@index([company_code])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model adjustments_1380 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  wms_doc_type             String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "adjustments_1380_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "adjustments_1380_company_code_wms_id_transaction_date_idx")
  @@index([company_code])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model incoming_goods_1310 {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  incoming_evidence_number  String              @db.VarChar(50)
  incoming_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  shipper_name              String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, id, incoming_date], map: "incoming_goods_1310_company_code_id_incoming_date_idx")
  @@unique([company_code, wms_id, incoming_date], map: "incoming_goods_1310_company_code_wms_id_incoming_date_idx")
  @@index([company_code])
  @@index([company_code, incoming_date, deleted_at])
  @@index([customs_document_type])
  @@index([incoming_date])
  @@index([incoming_evidence_number])
  @@index([ppkek_number])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model incoming_goods_1370 {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  incoming_evidence_number  String              @db.VarChar(50)
  incoming_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  shipper_name              String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, id, incoming_date], map: "incoming_goods_1370_company_code_id_incoming_date_idx")
  @@unique([company_code, wms_id, incoming_date], map: "incoming_goods_1370_company_code_wms_id_incoming_date_idx")
  @@index([company_code])
  @@index([company_code, incoming_date, deleted_at])
  @@index([customs_document_type])
  @@index([incoming_date])
  @@index([incoming_evidence_number])
  @@index([ppkek_number])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model incoming_goods_1380 {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  incoming_evidence_number  String              @db.VarChar(50)
  incoming_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  shipper_name              String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, id, incoming_date], map: "incoming_goods_1380_company_code_id_incoming_date_idx")
  @@unique([company_code, wms_id, incoming_date], map: "incoming_goods_1380_company_code_wms_id_incoming_date_idx")
  @@index([company_code])
  @@index([company_code, incoming_date, deleted_at])
  @@index([customs_document_type])
  @@index([incoming_date])
  @@index([incoming_evidence_number])
  @@index([ppkek_number])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model material_usages_1310 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  work_order_number        String?   @db.VarChar(50)
  cost_center_number       String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "material_usages_1310_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "material_usages_1310_company_code_wms_id_transaction_date_idx")
  @@index([company_code])
  @@index([company_code, transaction_date, deleted_at])
  @@index([cost_center_number])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
  @@index([work_order_number])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model material_usages_1370 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  work_order_number        String?   @db.VarChar(50)
  cost_center_number       String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "material_usages_1370_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "material_usages_1370_company_code_wms_id_transaction_date_idx")
  @@index([company_code])
  @@index([company_code, transaction_date, deleted_at])
  @@index([cost_center_number])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
  @@index([work_order_number])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model material_usages_1380 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  work_order_number        String?   @db.VarChar(50)
  cost_center_number       String?   @db.VarChar(100)
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "material_usages_1380_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "material_usages_1380_company_code_wms_id_transaction_date_idx")
  @@index([company_code])
  @@index([company_code, transaction_date, deleted_at])
  @@index([cost_center_number])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
  @@index([work_order_number])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model outgoing_goods_1310 {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  outgoing_evidence_number  String              @db.VarChar(50)
  outgoing_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  recipient_name            String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, id, outgoing_date], map: "outgoing_goods_1310_company_code_id_outgoing_date_idx")
  @@unique([company_code, wms_id, outgoing_date], map: "outgoing_goods_1310_company_code_wms_id_outgoing_date_idx")
  @@index([company_code])
  @@index([company_code, outgoing_date, deleted_at])
  @@index([customs_document_type])
  @@index([outgoing_date])
  @@index([outgoing_evidence_number])
  @@index([ppkek_number])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model outgoing_goods_1370 {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  outgoing_evidence_number  String              @db.VarChar(50)
  outgoing_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  recipient_name            String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, id, outgoing_date], map: "outgoing_goods_1370_company_code_id_outgoing_date_idx")
  @@unique([company_code, wms_id, outgoing_date], map: "outgoing_goods_1370_company_code_wms_id_outgoing_date_idx")
  @@index([company_code])
  @@index([company_code, outgoing_date, deleted_at])
  @@index([customs_document_type])
  @@index([outgoing_date])
  @@index([outgoing_evidence_number])
  @@index([ppkek_number])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model outgoing_goods_1380 {
  id                        Int                 @default(autoincrement())
  wms_id                    String              @db.VarChar(100)
  company_code              Int
  owner                     Int
  customs_document_type     CustomsDocumentType
  ppkek_number              String              @db.VarChar(50)
  customs_registration_date DateTime            @db.Date
  outgoing_evidence_number  String              @db.VarChar(50)
  outgoing_date             DateTime            @db.Date
  invoice_number            String              @db.VarChar(50)
  invoice_date              DateTime            @db.Date
  recipient_name            String              @db.VarChar(200)
  timestamp                 DateTime            @db.Timestamptz(6)
  created_at                DateTime            @default(now()) @db.Timestamptz(6)
  updated_at                DateTime            @db.Timestamptz(6)
  deleted_at                DateTime?           @db.Timestamptz(6)

  @@unique([company_code, id, outgoing_date], map: "outgoing_goods_1380_company_code_id_outgoing_date_idx")
  @@unique([company_code, wms_id, outgoing_date], map: "outgoing_goods_1380_company_code_wms_id_outgoing_date_idx")
  @@index([company_code])
  @@index([company_code, outgoing_date, deleted_at])
  @@index([customs_document_type])
  @@index([outgoing_date])
  @@index([outgoing_evidence_number])
  @@index([ppkek_number])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model production_outputs_1310 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "production_outputs_1310_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "production_outputs_1310_company_code_wms_id_transaction_dat_idx")
  @@index([company_code])
  @@index([company_code, transaction_date, deleted_at])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model production_outputs_1370 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "production_outputs_1370_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "production_outputs_1370_company_code_wms_id_transaction_dat_idx")
  @@index([company_code])
  @@index([company_code, transaction_date, deleted_at])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model production_outputs_1380 {
  id                       Int       @default(autoincrement())
  wms_id                   String    @db.VarChar(100)
  company_code             Int
  internal_evidence_number String    @db.VarChar(50)
  transaction_date         DateTime  @db.Date
  reversal                 String?   @db.VarChar(1)
  timestamp                DateTime  @db.Timestamptz(6)
  created_at               DateTime  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime  @db.Timestamptz(6)
  deleted_at               DateTime? @db.Timestamptz(6)

  @@unique([company_code, id, transaction_date], map: "production_outputs_1380_company_code_id_transaction_date_idx")
  @@unique([company_code, wms_id, transaction_date], map: "production_outputs_1380_company_code_wms_id_transaction_dat_idx")
  @@index([company_code])
  @@index([company_code, transaction_date, deleted_at])
  @@index([internal_evidence_number])
  @@index([transaction_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model wip_balances_1310 {
  id           Int       @default(autoincrement())
  wms_id       String    @db.VarChar(100)
  company_code Int
  item_type    String    @db.VarChar(10)
  item_code    String    @db.VarChar(50)
  item_name    String    @db.VarChar(200)
  stock_date   DateTime  @db.Date
  uom          String    @db.VarChar(20)
  qty          Decimal   @db.Decimal(15, 3)
  timestamp    DateTime  @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @db.Timestamptz(6)
  deleted_at   DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, stock_date], map: "wip_balances_1310_company_code_wms_id_stock_date_idx")
  @@index([company_code])
  @@index([item_code])
  @@index([item_type])
  @@index([stock_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model wip_balances_1370 {
  id           Int       @default(autoincrement())
  wms_id       String    @db.VarChar(100)
  company_code Int
  item_type    String    @db.VarChar(10)
  item_code    String    @db.VarChar(50)
  item_name    String    @db.VarChar(200)
  stock_date   DateTime  @db.Date
  uom          String    @db.VarChar(20)
  qty          Decimal   @db.Decimal(15, 3)
  timestamp    DateTime  @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @db.Timestamptz(6)
  deleted_at   DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, stock_date], map: "wip_balances_1370_company_code_wms_id_stock_date_idx")
  @@index([company_code])
  @@index([item_code])
  @@index([item_type])
  @@index([stock_date])
  @@index([wms_id])
}

/// This table is a partition table and requires additional setup for migrations. Visit https://pris.ly/d/partition-tables for more info.
model wip_balances_1380 {
  id           Int       @default(autoincrement())
  wms_id       String    @db.VarChar(100)
  company_code Int
  item_type    String    @db.VarChar(10)
  item_code    String    @db.VarChar(50)
  item_name    String    @db.VarChar(200)
  stock_date   DateTime  @db.Date
  uom          String    @db.VarChar(20)
  qty          Decimal   @db.Decimal(15, 3)
  timestamp    DateTime  @db.Timestamptz(6)
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  updated_at   DateTime  @db.Timestamptz(6)
  deleted_at   DateTime? @db.Timestamptz(6)

  @@unique([company_code, wms_id, stock_date], map: "wip_balances_1380_company_code_wms_id_stock_date_idx")
  @@index([company_code])
  @@index([item_code])
  @@index([item_type])
  @@index([stock_date])
  @@index([wms_id])
}

enum CustomsDocumentType {
  BC23
  BC27
  BC40
  BC30
  BC25
  BC261
  BC262
  BC41
}

enum AdjustmentType {
  GAIN
  LOSS
}

enum Currency {
  USD
  IDR
  CNY
  EUR
  JPY
}

enum CompanyStatus {
  ACTIVE
  INACTIVE
}

enum CalculationMethod {
  TRANSACTION
  WIP_SNAPSHOT

  @@map("calculation_method")
}

enum RecalcStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED

  @@map("recalc_status")
}

// ============================================================================
// STOCK OPNAME (PHYSICAL INVENTORY COUNT)
// ============================================================================

enum StockOpnameStatus {
  OPEN      // Draft mode - can edit
  PROCESS   // Under review - limited editing
  RELEASED  // Finalized - read-only, affects stock

  @@map("stock_opname_status")
}

model stock_opnames {
  id              Int                @id @default(autoincrement())
  sto_number      String             @unique @db.VarChar(50) // STO-YYYYMMDD-XXX
  company_code    Int
  sto_datetime    DateTime           @db.Timestamptz(6) // Date and time of stock opname
  pic_name        String?            @db.VarChar(200) // Person in charge (optional)
  status          StockOpnameStatus  @default(OPEN)
  created_by      String             @db.VarChar(100) // Username who created
  created_at      DateTime           @default(now()) @db.Timestamptz(6)
  updated_at      DateTime           @updatedAt @db.Timestamptz(6)
  deleted_at      DateTime?          @db.Timestamptz(6)

  // Relations
  company companies            @relation(fields: [company_code], references: [code], onDelete: Cascade)
  items   stock_opname_items[]

  // Indexes for optimal query performance
  @@index([company_code, sto_datetime]) // Filter by company and date range
  @@index([sto_number]) // Quick lookup by STO number
  @@index([status]) // Filter by status
  @@index([created_at]) // Sort by creation date
  @@index([company_code, status, sto_datetime]) // Composite for common queries
}

model stock_opname_items {
  id              BigInt    @id @default(autoincrement())
  stock_opname_id Int
  company_code    Int
  item_code       String    @db.VarChar(50)
  item_name       String    @db.VarChar(200) // Denormalized for performance
  item_type       String    @db.VarChar(10) // Denormalized (ROH, HALB, FERT, etc.)
  uom             String    @db.VarChar(20) // Denormalized
  sto_qty         Decimal   @db.Decimal(15, 3) // Physical count quantity
  end_stock       Decimal   @db.Decimal(15, 3) // System stock at STO datetime (denormalized)
  variant         Decimal   @db.Decimal(15, 3) // Calculated: sto_qty - end_stock
  report_area     String?   @db.VarChar(100) // Optional location/area
  remark          String?   @db.Text // Optional notes
  created_at      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at      DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at      DateTime? @db.Timestamptz(6)

  // Relations
  stock_opname stock_opnames @relation(fields: [stock_opname_id], references: [id], onDelete: Cascade)

  // Indexes for optimal query performance
  @@unique([stock_opname_id, item_code]) // Prevent duplicate items in same STO
  @@index([stock_opname_id]) // Fast joins with parent
  @@index([item_code]) // Filter/search by item
  @@index([item_type]) // Filter by item type
  @@index([company_code]) // Filter by company
  @@index([company_code, item_code]) // Covering index for common queries
  @@index([variant]) // Find items with discrepancies
}
